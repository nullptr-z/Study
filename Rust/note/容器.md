### Rust 内存管理设计思想

Rust 的创造者们，重新审视了堆内存的生命周期，发现**大部分堆内存的需求在于动态大小，小部分需求是更长的生命周期**。所以它默认将堆内存的生命周期和使用它的栈内存的生命周期绑在一起，并留了个小口子 leaked 机制，让堆内存在需要的时候，可以有超出帧存活期的生命周期。

## Box

`Box<T>` 一个智能指针,在堆内存上创建在数据结构,在栈上创建一个指向该结构的指针,生命周期和这个指针一致,编译时确定 size,{ ptr, len }
`Box::leak(Box::new(T))` 强制结构 T 创建在堆上;绕过静态检查,拥有静态生命周期

## RefCell

获得内部数据的可变借用,使用花括号缩小`v`的生命周期,保证了不会和后续的借用冲突，且不会引用已释放内存

```rs
{
  let data = RefCell::new(1);
  {
    let mut v = data.borrow_mut();
    *v += 1;

    println!("data: {:?}", data.borrow());
  }
}
```

## Arc

引用技术，多线程中安全访问

```rs
/// 创建一个只读字符串切片
Arc::<str>::from("123")
/// 匹配两个指针指向同一个元素
Arc::ptr_eq(p, q)
```
