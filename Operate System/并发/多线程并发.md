## 特质

1. 线程由内核自动调度

2. 每个线程独立上下文，相比进程切换上下文小得多：

- 唯一整数线程 TID
- 栈空间
- 栈指针
- 程序计数器
- 通用目的寄存器
- 条件码（flags）

3. 所有线程共享一共进程虚拟内存地址空间
   共享的内容：

- 代码段
- 数据
- 堆
- 共享库
- 打开的文件

## 对等线程

一个进程中由主线程创建的任意线程，称其他线程为对等线程

## 主线程

它是进程中第一个运行的线程，正常运行结束情况下它最后被销毁；它类似于根

## 核心函数

1. 创建线程

```c
int pthread_create(pthread_t* tid, pthread_attr_t* attr, func*, void* arg)

```

成功创建时，tid 中保存新线程的 ID

2. 终止线程
   >

```c
void pthread_exit(void *return_val)
```

- 结束当前线程并返回`return_val`; 注意这个函数本身并没有返回值，`return_val`被`pthread_join`接受
- 如果是主线程调用这个函数，它会等待所有子线程执行完毕；注意如果主线程中直接使用 return 语句，没有执行完的子线程，会全部被强制结束

>

```c
pthread_cancel(pthread_t tid)
```

- 终止传入的`tid`对等线程

> exit( ) 函数

- 任意线程调用这个函数，整个进程都会结束

3. 等待线程

```c
int pthread_join(pthread_t tid, void** return_val)
```

阻塞等待`tid`线程结束，`return_val`中接受`pthread_exit`的返回值，回收终止线程的资源

4. 分离线程

```c
int pthread_detach(pthread tid)
```

通过`pthread_self`获取自身线程 ID，将自己从对等线程池中分离出来

场景：web 服务通常都是一个线程处理一个链接，主线程不应该等待这个子线程结束，才去处理下一个链接

## 辅助函数

- 子线程获取自身 TID

```c
pthread_t pthread_self()
```

- 设置线程例程相关的状态

```c
pthread_once()
```

需要动态初始化多个线程共享的全局变量时会用到

## 共享变量

在多线程中共享变量有多钟形式：

- 全局变量
- 静态变量
- 对主线程中变量的引用

这并不包含所有情况；

总的来看就是，静态存储区的变量，主线程中的自动变量的引用，如果这些变量在对等线程中使用，他们就是共享的
