## 乱序

cpu 通过乱序，先执行耗时较长的内存操作这类指令，同时执行短耗时指令，这样最终耗时取只有最长耗时

## 伪共享

为了避免伪共享，可以通过在共享变量前后各添加 64 字节（这个大小因 CPU 架构的缓存行大小而异，但大多数现代 CPU 的缓存行大小是 64 字节）的 padding 来确保这些共享变量被独占一个缓存行，从而避免伪共享。这种技术可以显著提高多线程程序对共享变量访问的效率。

## 原子指令

原子指令，对其他线程的可见性,有序性；
就是说一个并发程序中，原子指令的那条代码，在不同线程或进程中它们的关系是串行的，一定有先后关系，取决于谁先谁后。所有的状态变化也是及时可见的

原理：原子指令会给总线上锁，停止其他所有工作 pipeline

屏障指令阻止他前后的两条指令乱序执行

## 原子函数的实现

- 包含一个原子指令，也就是不能被打断的汇编指令，例如 lock、xchg
- 包含一个 compile barrier，编译器不对其进行优化
- 包含一个 memory fence，保证可见性
