域名层级是从右往左的，edu本身就是一个合法域名，二级域名 cmu.edu，三级域名 cs.cmu.edu

# DNS
*domain name system 域名系统 基于 UDP协议*
它通常被其他应用层协议使用
它使用的是分布式数据库存储 IP 地址目录，53 端口号

> 提供便于人们记忆的地址(域名)，到网络 IP地址 的转换服务，
> 别名，将多个域名绑定到一个 IP 地址

## 工作原理
对应用程序来看他就是一个提供简单转换服务的黑盒子，实际上..

全球分布了大量 DNS 服务器,并且是持续增长的，还定义与不同应用层通信的协议

因为是分布式的，应用程序通常会访问到邻近的 DNS服务器地址

**当应用程序要请求一个主机时，他需要依次访问：**

操作系统里有一层`本地DNS服务器`，他负责跟 DNS 服务器交互，最后吧 IP 返回给请求者的
*以下暂且称呼为 Intel DNS*
1. 根DNS服务器: 返回顶级域的地址；全球有 13 个 IPV4 的 DNS 服务器，12 个在美国，1 个在日本；400 多个 IPV6
2. 顶级域DNS服务器(TLD)：返回权威DNS地址；它记录顶级域例如.com .net和国际级顶级域,他根据域名后缀查找对应的权威 DNS 服务器地址，并返回给本地DNS服务器
3. 权威DNS服务器：返回网站的 IP 地址；记录了主机对应的 IP 地址，大多数学校和大公司都为了自己的权威 DNS 服务器
> 本地 -> 根 -> 本地 -> 顶级 -> 本地 -> 权威 -> 本地

* 本地服务器 DNS 缓存
每当它会`缓存`来自其他 DNS 服务器回答的所有信息，从通常两天清除一次该缓存，当然时间是可配置的
有了缓存当它管辖内的主机发送请求时，他就可以直接返回域名到 IP 地址的映射，大大减少Intel DNS 的访问


## DNS 资源记录(RR)
*(Name，Value，Type，TTL)*

> TTL：记录了生存周期，何时从缓存中清除
> Type：A, Name 是主机名，Value 是对应的 IP 地址
> Type：NS, Name 是域，Value 记录了查询该域中主机 IP 地址的权威 DNS 服务器主机名
> Type：CNAME，Value是别名为 Name 的主机对应的规范主机名
> Type：MX，Value是别名为 Name 的邮件服务器的规范主机名；仅用于将邮件服务器


## DNS报文
*分为查询和回答两种报文，格式相同*
![DNS 报文格式](./../DNS%20报文格式.png)

### 首部区域：高位 12个字节，分成 6 个字段/2字节

1. 标识符：客户使用它匹配请求和回答
2. 标志：按位标识；(0 查询，1 回答) (1 权威 DNS) (1 递归可用)
> 还有4个有关数量的字段，这些字段指出了在首部后面的4类数据区域出现的数量


## DNS 数据库中插入记录
1. 注册登记机构提供需要登记的域名，提供权威/辅助 DNS 服务器信息
2. 机构会在[TLD]中插入一个 NS 类型和一个 A 类型记录
*假设注册域名 mynetwork.com, 权威 DNS 为：dns.mynetwork.com 212.212.212.1*
(mynetwork.com, dns.mynetwork.com, NS)
(dns.mynetwork.com, 212.212.212.1, A)







