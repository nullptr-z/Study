_应用层协议常常被开发者，误以为是网络应用程序的一部分，实际它应该属于网络协议部分_

1. 如何构造报文？
2. 报文中各个字段的含义？
3. 何时发送报文？

## HTTP 协议--超文本传输协议

当今 web 的核心,它分为客户端和服务端，通过交换 http 报文进行回话

- 使用 TCP 协议作为运输载体,使用套接字接口与之 TCP 收发报文，一旦向套接字接口发送一个请求报文（与 TCP 链接），这个报文就脱离控制，完全由 TCP 接管
- HTTP 是**无状态协议**，每次请求都是独立存在，服务器不会保存来自同一客户的信息
- HTTP 与 TCP 默认使用`持续性链接`（即，所有请求/响应使用相同的 TCP 链接），但是也能配置成`非持续链接`

- 请求报文至少一行

- 非持续性链接：

  > 如果在网页访问中服务器要返回 N 个资源（文件、图片），那么每个资源都会经历 TCP 链接/断开, 至少 N\*2 个 RTT，经历三次握手

- 持续性链接：

  > 一个完整的 web 页面，使用单个持续 TCP 链接进行传送
  > 可以连续发出请求（流水线，串行）

- HTTP2:

  > 二进制传输
  > 同一域名下的链接使用一个 TCP 链接；一台服务器上的多个 web 页面，发送给同一个客户时也可以在一个持续 TCP 链接上进行
  > 多路复用： HTTP2 请求和回答还可以是交错的（并行）
  > Header 压缩，部首在持续连接中一直被缓存，只需要追加或者替换部首
  > server push,服务器主动推送客户端会用到的文件，但是客户端可选择是否接受

- htt2 增加了哪些
  > 二进制传输
  > 多路复用，在服务器上对同一个域名下的的访问，多个 HTTP 连接贡献一个 TCP 连接，TCP 是持续的，只需要经历一次*三次握手*
  > 头部压缩
  > 服务端主动推送，减少客户请求

## 实体体 entity body

当在讨论报文的时候，常被称作`对象`

> GET 请求时是空的
> POST 请求时，实体体包含的内容为表单字段/值

## HTTP 请求报文

1. 请求行：请求类型(方法) 、请求 URL 、HTTP 版本号

2. 首部行：

   > 域名/地址
   > Connection: close 不使用持续链接
   > User-agent：客户浏览器类型，环境
   > Accept-language: 希望得到对象的语法版本

3. PUT 方法
   它允许客户上传对象到，Web 服务器上并指定路径

4. DELETE 方法
   它允许客户删除对象到，Web 服务器上并指定路径

5. HEAD 方法
   类似 GET，服务做出响应，但是不返回请求对象，通常用于调试

## HTTP 响应报文

> Connection: close 通知客户本次报文发送完后将关闭链接
> Date: 发送`报文`的日期时间（国标）
> Server: 标明允许服务的务器系统类型；类似请求报文中的 User-agent
> Last-Modified: 标明对象创建或最后一次修改时间
> Content-Length：被发送对象的字节数
> Content-Type：标明对实体体对象的类型；如：html、binary、base64

- 状态码
  200：请求成功，响应内容
  301：请求对象被转移了，新的 URL 在响应报文 Location 中，客户端自动获取新的 URL
  400：服务器无法识别的请求
  404：错误 URL，服务器不存在的 URL
  505：服务器不支持的 HTTP 协议版本

## Cookie

用户和服务器首次通信时，由服务器创建的一个 ID，作为用户身份标识
把 HTTP 从无状态变成了有状态，意思就是服务器通过 Cookie 信息，知道了客户端是谁，曾经和他有过一些什么样的交互；

Cookie 有很多应用场景，常被用于记录你的姓名、电话、信用卡号、邮件地址等，它所以他不是安全，不应该用于存储敏感信息

> 购物网站可以向你推荐你想买的物品
> 搜索记录
> 方便浏览器自动填充表单信息

存储用户的站点访问信息，这些信息对`任何站点都是公开`的。例如你在访问京东可以读取你在淘宝留下的信息

## Web 缓存器/代理服务器

`CDN`
位于客户和服务器之间，既是客户也是服务
如果有缓存返回客户网页副本；如果没有则向服务器请求，并保存副本

> 减少服务对客户的响应时间
> 减少服务器成本，例如算力、带宽
> ISP 中的缓存器还能减少，直接对 Intent 层的访问

- 条件 GET：在 get 请求报文中添加`If-Modified-Since`首部行

- 更新缓存
  > 缓冲器向服务器发起请求，并在`If-Modified-Since`中填入，上一次服务器响应的`Last-Modified`的时间
  > 如果服务器检查时间，如果在这候之后网页已经发生修改，则在响应报文中返回对象；
  > 没有则响应对象为空，并且状态码为‘304’: 表明没有发生更改，副本任然有效

## CGI

公共网关接口（Common Gateway Interface，CGI）是 Web 服务器运行时外部程序的规范，按 CGI 编写的程序可以扩展服务器功能。CGI 应用程序能与浏览器进行交互，还可通过数据 API 与数据库服务器等外部数据源进行通信，从数据库服务器中获取数据。格式化为 HTML 文档后，发送给浏览器，也可以将从浏览器获得的数据放到数据库中。几乎所有服务器都支持 CGI，可用任何语言编写 CGI，包括流行的 C、C ++、Java、VB 和 Delphi 等。

## HTTP1.x 半双工

客户端没有发起请求时，服务端不会主动发起；
请求的顺序和响应的顺序一一对应，不会乱序，这是一种**应用层列头阻塞**的通讯

HTTP2 在 1.1 上做了微小改动

## 应用层的数据与控制

数据与控制混合在一起的时候，大容量数据传输会导致阻塞后续的简短指令传输

> 控制链接：建立一个长连接，用于交互式命令，
> 数据连接：当遇到大容量数据传输的时候，创建一个新的临时链接，专门用于传输这组大量数据

## HTTP3

基于 Quick 协议，基于 UDP

- 解决头了端阻塞问题
